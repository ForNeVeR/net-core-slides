<html>
    <head>
        <meta charset="UTF-8"/>
        <link rel="stylesheet" href="node_modules/reveal.js/css/reveal.css">
        <link rel="stylesheet" href="node_modules/reveal.js/css/theme/white.css">
    </head>
    <body>
        <div class="reveal">
            <div class="slides">
                <section data-markdown>
                    <script type="text/template">
                        ## .NET Core
                        ---
                        <footer style="text-align: right;">
                            by: <img src="images/avatar.png"
                                     style="width: 1em; height: 1em; margin: 0; border: 0; box-shadow: none;" /><br/>
                            https://github.com/ForNeVeR<br/>
                            https://fornever.me/
                        </footer>

                        <aside class="notes">
                            Доклад посвящён новому развивающемуся варианту
                            фреймворка .NET от Microsoft: .NET Core.
                        </aside>
                    </script>
                </section>
                <section data-markdown>
                    <script type="text/template">
                        ## Архитектура .NET

                        ![Архитектура .NET](images/net-core-architecture.png)
                        <small>
                            (https://habrahabr.ru/company/microsoft/blog/323452/)
                        </small>

                        <aside class="notes">
                            Поговорим об архитектуре .NET в том виде, в каком
                            его сегодня видят в Microsoft. Есть три основных
                            современных варианта: основной, старый добрый .NET
                            под Windows, вариант поновее — Xamarin для мобильных
                            платформ, и совсем новый, только что появившийся
                            .NET Core. Все вместе они формируют экосистему,
                            полноценно поддерживаемую сегодня в Microsoft.

                            Есть инструменты разработки (не только для Windows),
                            с помощью которых можно компилировать и деплоить
                            приложения, написанные на .NET, и низлежащая
                            платформа.

                            Чтобы как-то привести всё это разнообразие к единому
                            знаменателю, вводятся новые понятия на этой самой
                            платформе. Одним из важнейших изменений является
                            введение  .NET Standard Library. В некотором роде
                            это подмножество знакомой нам BCL, но полностью
                            расшаренное между тремя верхними платформами. То
                            есть все классы, входящие в стандартную библиотеку,
                            будут доступны под любым из вариантов .NET, и к тому
                            же портабельные библиотеки (или наши собственные
                            DLL) можно таргетировать на .NET Standard.
                            Получается эдакий аналог старых PCL.

                            Всё, что изображено на слайде, уже выпущено в релиз,
                            это уже можно встретить в NuGet и уже можно
                            пользоваться.
                        </aside>
                    </script>
                </section>
                <section data-markdown>
                    <script type="text/template">
                        ## Средства разработки

                        - Visual Studio 2017: разработка под Windows; поддержка
                          отладки в Docker или по SSH
                        - Visual Studio Code: поддержка разработки на других
                          платформах
                        - JetBrains Rider: ReSharper + IDEA = ♥

                        <aside class="notes">
                            На сегодняшний момент основные инструменты для
                            разработки под обычный .NET уже успели обзавестись
                            средствами для интеграции с .NET Core — не всегда
                            хорошими, но хоть какими-то. Microsoft продвигает
                            Visual Studio для пользователей Windows и VS Code
                            для пользователей других операционных систем.

                            Ещё у них есть VS for Mac, но, как мне показалось,
                            это больше для Xamarin, а не для серверной
                            разработки, например.

                            Помимо этого, многие наверняка слышали про новую IDE
                            от JetBrains — Rider. Она также поддерживает
                            программирование на .NET Core под всеми платформами.
                        </aside>
                    </script>
                </section>
                <section data-markdown>
                    <script type="text/template">
                        ## .NET Standard

                        ![Версии .NET Standard](images/net-standard-versions.png)

                        <aside class="notes">
                            Многие уже видели эту табличку с версиями .NET
                            Standard. Сейчас я поясню, почему эта таблица может
                            быть нам важна.

                            Итак, у стандартной библиотеки есть версии: 1.0 —
                            1.6, и отдельно стоящая будущая версия 2.0.

                            Мы видим, что для всех существующих вариантов
                            использования .NET — для десктопного фреймворка,
                            .NET Core, Xamarin — указаны совместимые версии
                            библиотеки. Например, если я пишу на .NET 4.5, это
                            значит, что я могу использовать пакеты, которые
                            таргетируют .NET Standard 1.1 и выше.

                            Вся эта таблица просто показывает версии стандарта и
                            совместимые с ними версии фреймворков.

                            Стоит отметить, что для Xamarin до сих пор значится
                            "vNext", что значит, что пока что в Xamarin-проектах
                            нельзя использовать пакеты, таргетирующие .NET
                            Standard. Впрочем, эта табличка может быть старой
                            (хотя она и взята из официальной документации), так
                            что, может, использовать эти пакеты в
                            Xamarin-приложениях уже разрешили.
                        </aside>
                    </script>
                </section>
                <section data-markdown>
                    <script type="text/template">
                        ## .NET Standard 2.0

                        ![Содержимое .NET Standard 2.0](images/net-standard-libraries.png)
                        <small>
                            (https://weblog.west-wind.com/posts/2016/Nov/23/NET-Standard-20-Making-Sense-of-NET-Again)
                        </small>

                        <aside class="notes">
                            Вот список того, что входит в эту стандартную
                            библиотеку, но каких-то особых откровений тут нет,
                            в общем-то это и есть современный вариант BCL без
                            GUI и вещей, завязанных на COM и Remoting.

                            Важно, что привычных GUI-компонентов (Windows Forms
                            или WPF) для .NET Core не доступно и пока не
                            планируется. Если очень хочется делать GUI, то есть
                            сторонние open-source библиотеки (Avalonia,
                            например).
                        </aside>
                    </script>
                </section>
                <section data-markdown>
                    <script type="text/template">
                        ## Даты выпуска новых компонентов

                        | **Milestone**             | **Release Date** |
                        |:--------------------------|:-----------------|
                        | .NET Core 2.0 Preview     | Q2 2017          |
                        | .NET Standard 2.0 Preview | Q2 2017          |
                        | .NET Core 2.0             | Q3 2017          |
                        | .NET Standard 2.0         | Q3 2017          |

                        <small>
                            (https://github.com/dotnet/core/blob/master/roadmap.md)
                        </small>
                        <aside class="notes">
                            А вот даты выпуска следующего стандарта. Во втором
                            квартале обещают какое-то превью, ну и совсем
                            по-настоящему выпустят в третьем квартале этого
                            года.

                            Это относится только ко второму стандарту. Версия
                            1.6 уже выпущена прямо сейчас, можно ей
                            пользоваться (и, соответственно, библиотеками,
                            которые к ней привязаны).
                        </aside>
                    </script>
                </section>
                <section data-markdown>
                    <script type="text/template">
                        ## .NET: open-source

                        - Runtime: https://github.com/dotnet/coreclr
                        - Стандартная библиотека: https://github.com/dotnet/corefx
                        - ASP.NET: https://github.com/aspnet/Mvc

                        <aside class="notes">
                            Со стандартом мы закончили, теперь перейдём к,
                            собственно, .NET Core. Как многие знают, теперь .NET
                            является опенсорсным и выложен под пермиссивной
                            лицензией на GitHub. Вот несколько ссылок на
                            основные компоненты.

                            В open-source выложены ещё не все компоненты,
                            которые хотелось бы видеть — например, WPF или
                            Windows Forms так и не опубликовали, и непонятно,
                            собираются или нет.

                            Основной десктопный фреймворк (тот, который не Core)
                            шарит некоторые части кода с вот этими исходниками —
                            в частности, код сборщика мусора, насколько я
                            понимаю, тот же самый в .NET Core и в обычном .NET,
                            только собирается с разными флагами.

                            Mono также начинает переносить себе основные
                            компоненты из .NET Core, чтобы стать лучше и
                            совместимее.
                        </aside>
                    </script>
                </section>
                <section data-markdown>
                    <script type="text/template">
                        ## Поддерживаемые .NET Core платформы

                        - **Windows**: 7, 8, 8.1, 10
                        - **Linux**: RHEL 7+, Ubuntu 14.04+, CentOS 7, Debian 8,
                          Fedora 23+, OpenSuse 13.2+, Oracle Linux 7+, Mint 17+
                        - **macOS**: 10.10+
                        - **Docker**: `microsoft/dotnet:runtime`,
                          `microsoft/dotnet:nanoserver-runtime`

                        <aside class="notes">
                            Не думаю, что для кого-то будет сюрпризом, что .NET
                            Core полноценно поддерживает Linux и macOS. Для
                            Linux пока что выбор дистрибутивов ограничен, и под
                            какие-то кроме перечисленных собирать очень
                            проблематично (потому что для начальной компиляции),
                            потому что для некоторых компонентов нужен уже
                            собранный C#-компилятор, который сам написан на C#,
                            и поэтому ему к тому же нужен уже собранный рантайм!

                            Что ещё интересно — это поддержка Docker (а Docker,
                            напомню, сегодня работает на всех операционных
                            системах — вплоть до того, что в Windows Server
                            можно гонять специальные виндовые серверные
                            контейнеры). И в .NET Core поддерживаются все эти
                            виды контейнеризации!

                            Преимущества контейнеров заключаются в упрощённом
                            деплойменте и настройке приложений (которые
                            деплоятся просто как кучка контейнеров в
                            соответствии с каким-то конфигом), ну а ещё очень
                            удобно это дело масштабировать где-нибудь в облаке.
                        </aside>
                    </script>
                </section>
                <section data-markdown>
                    <script type="text/template">
                        ## Схемы разворачивания приложений

                        - Framework-dependent deployment
                        - Self-contained deployment

                        <aside class="notes">
                            Для .NET Core предлагается несколько вариантов
                            разворачивания: можно деплоиться на машину, где есть
                            глобально установленный фреймворк (типа того, как у
                            нас сегодня работают обычные серверные приложения:
                            сначала ставишь фреймворк, а потом запускаешь
                            программу).

                            Второй вариант деплоймента — это когда мы тащим
                            весь фреймворк вместе с собой. К сожалению, у меня
                            этот режим опробовать не получилось, потому что у
                            Microsoft там документация немножко устарела, но в
                            принципе очевидцы утверждают, что этот режим
                            работает. Можно даже на Windows собрать приложение,
                            указав, что мы хотим его задеплоить на Linux, и
                            система сборки подготовит все нужные бинарники со
                            включенными туда JIT, GC и всеми плюшками. И это
                            можно будет деплоить в одно из поддерживаемых
                            окружений.

                            Этот режим сделан для того, чтобы не зависеть от
                            глобальной инсталляции дотнета, а просто всё нужное
                            носить с собой.
                        </aside>
                    </script>
                </section>
                <section data-markdown>
                    <script type="text/template">
                        ## Компоненты .NET Core

                        - dotnet-cli
                        - MSBuild
                        - NuGet
                        - CoreCLR
                        - ASP.NET Core

                        <aside class="notes">
                            Сам по себе .NET Core состоит из различных
                            компонентов. `dotnet-cli` — это инструменты
                            управления окружением, пакетами и деплоймента (IDE
                            может на них навинчиваться сверху). MSBuild — это,
                            собственно, сборка проектов (MSBuild теперь, кстати,
                            стал полностью кроссплатформенным). NuGet, как и
                            раньше, предоставляет инфраструктуру для скачивания
                            библиотек, CoreCLR — это, собственно, рантайм. Ну а
                            ASP.NET Core — это новая версия ASP.NET, которая
                            умеет работать и в старом режиме, под обычным .NET
                            и на IIS, и в новом режиме — в виде self-host на
                            кроссплатформенном .NET Core.
                        </aside>
                    </script>
                </section>
                <section data-markdown>
                    <script type="text/template">
                        ## dotnet-cli

                        ![Пример использования](images/dotnet-cli.png)

                        <aside class="notes">
                            Немного про `dotnet-cli`. Это консольный инструмент
                            для того, чтобы работать с .NET Core-проектами. Это
                            штука, которая умеет собирать проекты, скачивать
                            зависимости и управлять установленными на машине
                            рантаймами (которых можно теперь поставить
                            несколько). Плюс в её инфраструктуру устанавливаются
                            вещи типа EF Migrations, которые раньше с какого-то
                            перепою нужно было выполнять в Package Manager
                            Console.

                            Видно, что часть задач, которые раньше выполняла
                            исключительно Visual Studio, типа оркестрации сборки
                            проекта, решили перенести сюда. Соответственно, и
                            Visual Studio с этой системой работает, когда нужно.
                        </aside>
                    </script>
                </section>
                <section data-markdown>
                    <script type="text/template">
                        ## MSBuild

                        ```xml
                        <Project Sdk="Microsoft.NET.Sdk">

                            <PropertyGroup>
                                <OutputType>Exe</OutputType>
                                <TargetFramework>netcoreapp1.0</TargetFramework>
                            </PropertyGroup>

                        </Project>
                        ```

                        <aside class="notes">
                            Раз уж заговорили про сборку, вспомним, чем в
                            Microsoft нас пугали некоторое время после начала
                            работ над .NET Core. Грозились убрать старые
                            проектные файлы и полностью выбросить MSBuild и
                            привычные нам `csproj`-файлы, заменив его неким
                            `project.json`. В первых превью-сборках так и
                            поступили, но потом оказалось, что MSBuild на самом
                            деле всем нравится, а для `csproj` написано
                            неимоверное количество тулинга.

                            Поэтому в итоге решили `project.json` упразднить, но
                            вместе с тем значительно упростить модель проекта,
                            используемую в `csproj`. Вот тут у меня записан
                            пример `csproj`, который генерируется по умолчанию
                            для проекта "Hello world". Если кто-нибудь раньше
                            заглядывал в `csproj`, то без труда заметит разницу:
                            теперь файл совершенно вменяемого размера, лишнего
                            мусора в нём нет. Даже список файлов теперь для
                            простых случаев не нужен — берётся всё, что в
                            текущем каталоге (но можно кастомизировать).
                        </aside>
                    </script>
                </section>
                <section data-markdown>
                    <script type="text/template">
                        ## ASP.NET Core

                        - гибрид ASP.NET MVC и WebAPI
                        - OWIN-подобная архитектура
                        - Kestrel — быстродействующий веб-сервер
                        - можно запускать и на обычном .NET (IIS), и на .NET
                          Core
                        - Microsoft рекомендует к использованию в сценариях, где
                          нужна кроссплатформенность, микросервисы,
                          контейнеризация, масштабирование

                        <aside class="notes">
                            Поскольку основное применение нового фреймворка —
                            это кроссплатформенная веб-разработка, то Microsoft,
                            конечно, особое внимание уделяет новому ASP.NET.

                            Более того, весь фреймворк раньше называли просто
                            "ASP.NET 5" — впрочем, от этого названия в итоге
                            отказались.

                            В целом старая архитектура более-менее сохранилась,
                            и человек, который уже писал на ASP.NET 4 под OWIN,
                            легко узнаёт похожие подходы. Из важных изменений —
                            объединили MVC и WebAPI, но так даже удобнее стало
                            работать.

                            Хостить ASP.NET Core можно как отдельно, в виде
                            self-host, так и по-старому — на IIS. Для self-host,
                            кстати, сделали быстродействующий сервер Kestrel,
                            который может потягаться с IIS даже в выполнении
                            основных задач.

                            В документации есть специальная страничка, которая
                            описывает, когда, по мнению Microsoft, нам следует
                            использовать ASP.NET Core. И там основными
                            преимуществами указана кроссплатформенность (что
                            понятно) и совместимость с контейнерами. А хорошая
                            совместимость с контейнерами (как основанными на
                            Windows, так и на Linux), по идее, значительно
                            облегчает масштабирование сервисов.
                        </aside>
                    </script>
                </section>
                <section data-markdown>
                    <script type="text/template">
                        ## JavaScriptServices

                        - https://github.com/aspnet/JavaScriptServices
                        - встраивание webpack в общий ресурсный конвеер ASP.NET
                        - рендеринг Angular2 и React на сервере

                        <aside class="notes">
                            Стоит упомянуть ещё одну фичу, которая доступна для
                            ASP.NET Core — это библиотека JavaScriptServices.
                            Она позволяет интегрировать всякие JavaScript'вые
                            штуки с серверным кодом. Например, можно рендерить
                            Angular2 или React-компоненты на стороне сервера, и
                            таким образом обеспечивать изоморфность приложения.
                        </aside>
                    </script>
                </section>
                </section>
                <section data-markdown>
                    <script type="text/template">
                        ## Характеристики

                        ![htop](images/stability.png)

                        <aside class="notes">
                            Ну и под конец скажу немного о стабильности нового
                            фреймворка. На картинке приведены затраты ресурсов
                            для функционирования двух простых небольших
                            production веб-приложений, которые крутятся у меня
                            на виртуальной машине в облаке.

                            Главные характеристики тут потребление реальной
                            оперативной памяти и процессорного времени. И видно,
                            что .NET Core по обеим характеристикам выигрывает у
                            Java — и это при том, что Java к тому же на этом
                            хосте иногда падает из-за out of memory!

                            В общем, .NET Core со своими задачами вполне
                            справляется, и можно начинать небольшие приложения
                            на нём выпускать в production.
                        </aside>
                    </script>
                </section>
                <section data-markdown>
                    <script type="text/template">
                        ## Это конец

                        <br/><br/><br/>
                        <small>Слайды доступны в репозитории https://github.com/ForNeVeR/net-core-slides</small>
                    </script>
                </section>
            </div>
        </div>
        <script src="node_modules/reveal.js/lib/js/head.min.js"></script>
        <script src="node_modules/reveal.js/js/reveal.js"></script>
        <script>
            var isPrintMode = window.location.search.match(/print-pdf/gi);
            var link = document.createElement('link');
            link.rel = 'stylesheet';
            link.type = 'text/css';
            link.href = isPrintMode
                ? 'node_modules/reveal.js/css/print/pdf.css'
                : 'node_modules/reveal.js/css/print/paper.css';
            document.getElementsByTagName('head')[0].appendChild(link);
            Reveal.initialize({
                dependencies: [
                    { src: 'node_modules/reveal.js/plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
                    { src: 'node_modules/reveal.js/plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } }
                ],
                showNotes: isPrintMode
            });
        </script>
    </body>
</html>
